# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура приложения
```
Код приложения разделен на слои согласно парадигме MVP: 
- Model - слой данных, отвечает за хранение и изменение данных
- View - слой представления, отвечает за отображение данных на странице, 
- Presenter - презентер, отвечает за связь представления и данных.
```

## Данные и типы данных, используемые в приложении

Описание карточки товара

```
export interface IProduct {
    id: string;
    title: string;
    description: string;
    category: string;
    image: string;
    price: number | null;
}
```

Интерфейс для хранения списка товаров 

```
export interface CatalogModel { 
    items: IProduct[];
    setItems(items: IProduct[]): void;
    getProduct(id: string): IProduct;
}
```

Интерфейс корзины

```
export interface IBasketModel { 
    items: Map<string, number>;
    add(id: string): void;
    remove(id: string): void;
}
```

Интерфейс для модального окна заказа

```
export interface IOrderForm {
    payment?: string;
    address?: string;
    phone?: string;
    email?: string;
    total?: string | number;
}
```

Интерфейс для брокера событий

```
export interface IEvents {
    on<T extends object>(event: EventName, callback: (data: T) => void): void;
    emit<T extends object>(event: string, data?: T): void;
    trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void;
}
```

Интерфейс конструктора

```
export interface IViewConstructor { 
    new (container: HTMLElement, events?: IEvents): IView; 
}
```

Интерфейс отображения

```
export interface IView { 
    render(data?: object): HTMLElement;
}
```

Данные карточки, используемые в форме при создании новой карточки

```
export type TCardInfo = Pick<ICard, 'name' | 'link'>;
```

Основные данные пользователя, которые можно редактировать

```
export type TUserPublicInfo = Pick<IUser, 'name' | 'about' | 'avatar'>;
```

Данные пользователя в форме редактирования профиля

```
export type TUserBaseInfo = Pick<IUser, 'name' | 'about'>;
```

Аватар пользователя

```
export type TUserAvatar = Pick<IUser, 'avatar'>;
```
## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- Model - слой данных, отвечает за хранение и изменение данных
- View - слой представления, отвечает за отображение данных на странице,
- Presenter - презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс BasketItemView

Класс, отвечающий за отображение отдельного товара в корзине. Он содержит элементы контейнера товара (например, название товара, кнопки "Добавить" и "Удалить") и метод render для отображения данных о товаре в интерфейсе.

#### Класс BasketView

Класс, отвечающий за отображение списка товаров в корзине. Он также имеет метод render для отображения списка элементов в интерфейсе.

#### Класс BasketModel

Этот класс реализует интерфейс IBasketModel. В конструкторе класса принимается объект events, представляющий собой интерфейс IEvents, который используется для генерации и обработки событий.

В классе определены следующие свойства и методы:

- product: Map<string, number> - переменная для хранения продуктов в корзине.
- items: Map<string, number> - переменная для хранения товаров и их количества в корзине.
- Метод add(id: string): void - добавляет товар в корзину. Если товар с заданным id уже есть в корзине, увеличивает его количество на 1, если нет - создает новую запись.
Метод remove(id: string): void - удаляет товар из корзины. Если товар с заданным id присутствует в корзине и его количество больше 0, уменьшает количество на 1. Если количество становится равным 0, товар удаляется из корзины.
- Метод _changed() - защищенный метод, который генерирует уведомление о изменениях в корзине. Он вызывает метод emit событийного объекта events, передавая тип события и список товаров в корзине.

#### Класс Api

Этот код представляет собой класс Api, который предоставляет методы для отправки HTTP-запросов к API.

В классе Api определены следующие типы:

ApiListResponse - обобщенный тип, представляющий ответ API, содержащий общее количество элементов (total) и массив элементов (items).

ApiPostMethods - тип, представляющий возможные методы запросов (POST, PUT, DELETE).

Класс содержит следующие методы и свойства:

- baseUrl - базовый URL для всех запросов.
- options - объект RequestInit, содержащий параметры и заголовки для всех запросов.
конструктор, который принимает базовый URL и дополнительные параметры для настройки запросов.
handleResponse(response: Response) - метод для обработки ответа от сервера. Если ответ успешен, возвращает объект JSON, иначе возвращает ошибку с текстом из поля error или статусом ответа.
- get(uri: string) - метод для отправки GET-запроса по указанному URI.
- post(uri: string, data: object, method: ApiPostMethods = 'POST') - метод для отправки POST-запроса или других методов, принимает URI, данные для отправки и метод запроса (по умолчанию POST).

Этот класс обеспечивает общий интерфейс для выполнения запросов к API и обработки ответов от сервера. Он удобен для работы с RESTful API, обрабатывает JSON-данные и упрощает отправку запросов различных типов.